using Database.IEC.Inputs.CSVs;

using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net.Http;
using System.Threading.Tasks;

namespace Database.IEC.Utils
{
	public class SeatCountDownloader
	{
		static readonly string LGE2000Base = "https://results.elections.org.za/home/LGEPublicReports/2/Seat%20Calculation%20Detail";
		static readonly string LGE2006Base = "https://results.elections.org.za/home/LGEPublicReports/95/Seat%20Calculation%20Detail";
		static readonly string LGE2011Base = "https://results.elections.org.za/home/LGEPublicReports/197/Seat%20Calculation%20Detail";
		static readonly string LGE2016Base = "https://results.elections.org.za/home/LGEPublicReports/402/Seat%20Calculation%20Detail";
		static readonly string LGE2021Base = "https://results.elections.org.za/home/LGEPublicReports/1091/Seat%20Calculation%20Detail";

		static string[][] LGE2000ProvincesMunicipalities = new string[][] {
			new string[] 
			{
				"EC05b1", "EC05b2",
				"EC101", "EC102", "EC103", "EC104", "EC105", "EC106", "EC107", "EC108", "EC109",
				"EC121", "EC122", "EC123", "EC124", "EC125", "EC126", "EC127", "EC128",
				"EC131", "EC132", "EC133", "EC134", "EC135", "EC136", "EC137", "EC138",
				"EC141", "EC142", "EC143", "EC144",
				"EC151", "EC152", "EC153", "EC154", "EC155", "EC156", "EC157",
				"ECDMA10", "ECDMA13", "ECDMA14", "ECDMA44",
				"Port Elizabeth"
			},
			new string[] 
			{
				"FS161", "FS162", "FS163", 
				"FS171", "FS172", "FS173",
				"FS181", "FS182", "FS183", "FS184", "FS185",
				"FS191", "FS192", "FS193", "FS194", "FS195",
				"FS201", "FS203", "FS204", "FS205",
				"FSDMA19"
			},
			new string[] 
			{
				"CBLC2", "CBLC8",
				"East Rand",
				"GT02b1",
				"GT411", "GT412", "GT414", "GT421", "GT422", "GT423",
				"GTDMA41",
				"Johannesburg",
				"Pretoria"
			},
			new string[] 
			{
				"Durban",
				"KZ211", "KZ212", "KZ213", "KZ214", "KZ215", "KZ216",
				"KZ221", "KZ222", "KZ223", "KZ224", "KZ225", "KZ226", "KZ227",
				"KZ232", "KZ233", "KZ234", "KZ235", "KZ236",
				"KZ241", "KZ242", "KZ244", "KZ245",
				"KZ252", "KZ253", "KZ254",
				"KZ261", "KZ262", "KZ263", "KZ265", "KZ266",
				"KZ271", "KZ272", "KZ273", "KZ274", "KZ275",
				"KZ281", "KZ282", "KZ283", "KZ284", "KZ285", "KZ286",
				"KZ291", "KZ292", "KZ293", "KZ294",
				"KZ5a1", "KZ5a2", "KZ5a3", "KZ5a4", "KZ5a5",
				"KZDMA22", "KZDMA23", "KZDMA27", "KZDMA43"
			},
			new string[] 
			{
				"CBDMA4",
				"CBLC6", 
				"NP03A2", "NP03A3", "NP04A1",
				"NP331", "NP332", "NP333", "NP334",
				"NP341", "NP342", "NP343", "NP344",
				"NP351", "NP352", "NP353", "NP354", "NP355",
				"NP361", "NP362", "NP364", "NP365", "NP366", "NP367"
			},
			new string[] 
			{
				"CBDMA3", "CBLC3", "CBLC4", "CBLC5",
				"MP301", "MP302", "MP303", "MP304", "MP305", "MP306", "MP307",
				"MP311", "MP312", "MP313", "MP314", "MP315", "MP316",
				"MP321", "MP322", "MP323", "MP324", 
				"MPDMA31", "MPDMA32"
			},
			new string[] 
			{
				"NW371", "NW372", "NW373", "NW374", "NW375",
				"NW381", "NW382", "NW383", "NW384", "NW385",
				"NW391", "NW392", "NW393", "NW394", "NW395", "NW396",
				"NW401", "NW402", "NW403", "NW404",
				"NWDMA37"
			},
			new string[]
			{
				"CBLC1", "CBLC7",
				"NC01B1",
				"NC061", "NC062", "NC064", "NC065", "NC066", "NC067",
				"NC071", "NC072", "NC073", "NC074", "NC075", "NC076", "NC077", "NC078",
				"NC081", "NC082", "NC083", "NC084", "NC085", "NC086",
				"NC091", "NC092", "NC093",
				"NCDMA06", "NCDMA07", "NCDMA08", "NCDMA09", "NCDMACB1",
				"NW1a1"
			},
			new string[] {
				"Cape Town",
				"WC011",
				"WC012",
				"WC013",
				"WC014",
				"WC015",
				"WC022",
				"WC023",
				"WC024",
				"WC025",
				"WC026",
				"WC031",
				"WC032",
				"WC033",
				"WC034",
				"WC041",
				"WC042",
				"WC043",
				"WC044",
				"WC045",
				"WC047",
				"WC048",
				"WC051",
				"WC052",
				"WC053",
				"WCDMA01",
				"WCDMA02",
				"WCDMA03",
				"WCDMA04",
				"WCDMA05"
			},
		};
		static string[][] LGE2006ProvincesMunicipalities = new string[][] {
			new string[] {
				"EC05b2",
				"EC05b3",
				"EC101",
				"EC102",
				"EC103",
				"EC104",
				"EC105",
				"EC106",
				"EC107",
				"EC108",
				"EC109",
				"EC121",
				"EC122",
				"EC123",
				"EC124",
				"EC125",
				"EC126",
				"EC127",
				"EC128",
				"EC131",
				"EC132",
				"EC133",
				"EC134",
				"EC135",
				"EC136",
				"EC137",
				"EC138",
				"EC141",
				"EC142",
				"EC143",
				"EC144",
				"EC151",
				"EC152",
				"EC153",
				"EC154",
				"EC155",
				"EC156",
				"EC157",
				"ECDMA10",
				"ECDMA13",
				"NMA"
			},
			new string[] {
				"FS161",
				"FS162",
				"FS163",
				"FS171",
				"FS172",
				"FS173",
				"FS181",
				"FS182",
				"FS183",
				"FS184",
				"FS185",
				"FS191",
				"FS192",
				"FS193",
				"FS194",
				"FS195",
				"FS201",
				"FS203",
				"FS204",
				"FS205",
				"FSDMA19"
			},
			new string[] {
				"EKU",
				"GT02b1",
				"GT02b2",
				"GT421",
				"GT422",
				"GT423",
				"GT481",
				"GT482",
				"GT483",
				"GTDMA48",
				"JHB",
				"TSH"
			},
			new string[] {
				"ETH",
				"KZ211",
				"KZ212",
				"KZ213",
				"KZ214",
				"KZ215",
				"KZ216",
				"KZ221",
				"KZ222",
				"KZ223",
				"KZ224",
				"KZ225",
				"KZ226",
				"KZ227",
				"KZ232",
				"KZ233",
				"KZ234",
				"KZ235",
				"KZ236",
				"KZ241",
				"KZ242",
				"KZ244",
				"KZ245",
				"KZ252",
				"KZ253",
				"KZ254",
				"KZ261",
				"KZ262",
				"KZ263",
				"KZ265",
				"KZ266",
				"KZ271",
				"KZ272",
				"KZ273",
				"KZ274",
				"KZ275",
				"KZ281",
				"KZ282",
				"KZ283",
				"KZ284",
				"KZ285",
				"KZ286",
				"KZ291",
				"KZ292",
				"KZ293",
				"KZ294",
				"KZ5a1",
				"KZ5a2",
				"KZ5a4",
				"KZ5a5",
				"KZ5a6",
				"KZDMA22",
				"KZDMA23",
				"KZDMA27",
				"KZDMA43"
			},
			new string[] {
				"NP03A2",
				"NP03A3",
				"NP03a4",
				"NP03a5",
				"NP03a6",
				"NP331",
				"NP332",
				"NP333",
				"NP334",
				"NP335",
				"NP341",
				"NP342",
				"NP343",
				"NP344",
				"NP351",
				"NP352",
				"NP353",
				"NP354",
				"NP355",
				"NP361",
				"NP362",
				"NP364",
				"NP365",
				"NP366",
				"NP367",
				"NPDMA33"
			},
			new string[] {
				"MP301",
				"MP302",
				"MP303",
				"MP304",
				"MP305",
				"MP306",
				"MP307",
				"MP311",
				"MP312",
				"MP313",
				"MP314",
				"MP315",
				"MP316",
				"MP321",
				"MP322",
				"MP323",
				"MP324",
				"MP325",
				"MPDMA32"
			},
			new string[] {
				"NW371",
				"NW372",
				"NW373",
				"NW374",
				"NW375",
				"NW381",
				"NW382",
				"NW383",
				"NW384",
				"NW385",
				"NW391",
				"NW392",
				"NW393",
				"NW394",
				"NW395",
				"NW396",
				"NW401",
				"NW402",
				"NW403",
				"NW404",
				"NW405",
			},
			new string[] {
				"NC061",
				"NC062",
				"NC064",
				"NC065",
				"NC066",
				"NC067",
				"NC071",
				"NC072",
				"NC073",
				"NC074",
				"NC075",
				"NC076",
				"NC077",
				"NC078",
				"NC081",
				"NC082",
				"NC083",
				"NC084",
				"NC085",
				"NC086",
				"NC091",
				"NC092",
				"NC093",
				"NC094",
				"NC451",
				"NC452",
				"NC453",
				"NCDMA06",
				"NCDMA07",
				"NCDMA08",
				"NCDMA09",
				"NCDMA45"
			},
			new string[] {
				"CPT",
				"WC011",
				"WC012",
				"WC013",
				"WC014",
				"WC015",
				"WC022",
				"WC023",
				"WC024",
				"WC025",
				"WC026",
				"WC031",
				"WC032",
				"WC033",
				"WC034",
				"WC041",
				"WC042",
				"WC043",
				"WC044",
				"WC045",
				"WC047",
				"WC048",
				"WC051",
				"WC052",
				"WC053",
				"WCDMA01",
				"WCDMA02",
				"WCDMA03",
				"WCDMA04",
				"WCDMA05"
			}
		};
		static string[][] LGE2011ProvincesMunicipalities = new string[][] {
			new string[] {
				"BUF",
				"DC10",
				"DC12",
				"DC13",
				"DC14",
				"DC15",
				"DC44",
				"EC101",
				"EC102",
				"EC103",
				"EC104",
				"EC105",
				"EC106",
				"EC107",
				"EC108",
				"EC109",
				"EC121",
				"EC122",
				"EC123",
				"EC124",
				"EC126",
				"EC127",
				"EC128",
				"EC131",
				"EC132",
				"EC133",
				"EC134",
				"EC135",
				"EC136",
				"EC137",
				"EC138",
				"EC141",
				"EC142",
				"EC143",
				"EC144",
				"EC153",
				"EC154",
				"EC155",
				"EC156",
				"EC157",
				"EC441",
				"EC442",
				"EC443",
				"EC444",
				"NMA"
			},
			new string[] {
				"DC16",
				"DC18",
				"DC19",
				"DC20",
				"FS161",
				"FS162",
				"FS163",
				"FS164",
				"FS181",
				"FS182",
				"FS183",
				"FS184",
				"FS185",
				"FS191",
				"FS192",
				"FS193",
				"FS194",
				"FS195",
				"FS196",
				"FS201",
				"FS203",
				"FS204",
				"FS205",
				"MAN"
			},
			new string[] {
				"DC42",
				"DC48",
				"EKU",
				"GT421",
				"GT422",
				"GT423",
				"GT481",
				"GT482",
				"GT483",
				"GT484",
				"JHB",
				"TSH"
			},
			new string[] {
				"DC21",
				"DC22",
				"DC23",
				"DC24",
				"DC25",
				"DC26",
				"DC27",
				"DC28",
				"DC29",
				"DC43",
				"ETH",
				"KZN211",
				"KZN212",
				"KZN213",
				"KZN214",
				"KZN215",
				"KZN216",
				"KZN221",
				"KZN222",
				"KZN223",
				"KZN224",
				"KZN225",
				"KZN226",
				"KZN227",
				"KZN232",
				"KZN233",
				"KZN234",
				"KZN235",
				"KZN236",
				"KZN241",
				"KZN242",
				"KZN244",
				"KZN245",
				"KZN252",
				"KZN253",
				"KZN254",
				"KZN261",
				"KZN262",
				"KZN263",
				"KZN265",
				"KZN266",
				"KZN271",
				"KZN272",
				"KZN273",
				"KZN274",
				"KZN275",
				"KZN281",
				"KZN282",
				"KZN283",
				"KZN284",
				"KZN285",
				"KZN286",
				"KZN291",
				"KZN292",
				"KZN293",
				"KZN294",
				"KZN431",
				"KZN432",
				"KZN433",
				"KZN434",
				"KZN435"
			},
			new string[] {
				"DC33",
				"DC34",
				"DC35",
				"DC36",
				"DC47",
				"LIM331",
				"LIM332",
				"LIM333",
				"LIM334",
				"LIM335",
				"LIM341",
				"LIM342",
				"LIM343",
				"LIM344",
				"LIM351",
				"LIM352",
				"LIM353",
				"LIM354",
				"LIM355",
				"LIM361",
				"LIM362",
				"LIM364",
				"LIM365",
				"LIM366",
				"LIM367",
				"LIM471",
				"LIM472",
				"LIM473",
				"LIM474",
				"LIM475"
			},
			new string[] {
				"DC30",
				"DC31",
				"DC32",
				"MP301",
				"MP302",
				"MP303",
				"MP304",
				"MP305",
				"MP306",
				"MP307",
				"MP311",
				"MP312",
				"MP313",
				"MP314",
				"MP315",
				"MP316",
				"MP321",
				"MP322",
				"MP323",
				"MP324",
				"MP325"
			},
			new string[] {
				"DC37",
				"DC38",
				"DC39",
				"DC40",
				"NW371",
				"NW372",
				"NW373",
				"NW374",
				"NW375",
				"NW381",
				"NW382",
				"NW383",
				"NW384",
				"NW385",
				"NW392",
				"NW393",
				"NW394",
				"NW396",
				"NW397",
				"NW401",
				"NW402",
				"NW403",
				"NW404"
			},
			new string[] {
				"DC6",
				"DC7",
				"DC8",
				"DC9",
				"NC061",
				"NC062",
				"NC064",
				"NC065",
				"NC066",
				"NC067",
				"NC071",
				"NC072",
				"NC073",
				"NC074",
				"NC075",
				"NC076",
				"NC077",
				"NC078",
				"NC081",
				"NC082",
				"NC083",
				"NC084",
				"NC085",
				"NC086",
				"NC091",
				"NC092",
				"NC093",
				"NC094",
				"NC451",
				"NC452",
				"NC453"
			},
			new string[] {
				"CPT",
				"DC1",
				"DC2",
				"DC3",
				"DC4",
				"DC5",
				"WC011",
				"WC012",
				"WC013",
				"WC014",
				"WC015",
				"WC022",
				"WC023",
				"WC024",
				"WC025",
				"WC026",
				"WC031",
				"WC032",
				"WC033",
				"WC034",
				"WC041",
				"WC042",
				"WC043",
				"WC044",
				"WC045",
				"WC047",
				"WC048",
				"WC051",
				"WC052",
				"WC053"
			},
		};
		static string[][] LGE2016ProvincesMunicipalities = new string[][] {
			new string[] {
				"BUF",
				"DC10",
				"DC12",
				"DC13",
				"DC14",
				"DC15",
				"DC44",
				"EC101",
				"EC102",
				"EC104",
				"EC105",
				"EC106",
				"EC108",
				"EC109",
				"EC121",
				"EC122",
				"EC123",
				"EC124",
				"EC126",
				"EC129",
				"EC131",
				"EC135",
				"EC136",
				"EC137",
				"EC138",
				"EC139",
				"EC141",
				"EC142",
				"EC145",
				"EC153",
				"EC154",
				"EC155",
				"EC156",
				"EC157",
				"EC441",
				"EC442",
				"EC443",
				"EC444",
				"NMA"
			},
			new string[] {
				"DC16",
				"DC18",
				"DC19",
				"DC20",
				"FS161",
				"FS162",
				"FS163",
				"FS181",
				"FS182",
				"FS183",
				"FS184",
				"FS185",
				"FS191",
				"FS192",
				"FS193",
				"FS194",
				"FS195",
				"FS196",
				"FS201",
				"FS203",
				"FS204",
				"FS205",
				"MAN"
			},
			new string[] {
				"DC42",
				"DC48",
				"EKU",
				"GT421",
				"GT422",
				"GT423",
				"GT481",
				"GT484",
				"GT485",
				"JHB",
				"TSH"
			},
			new string[] {
				"DC21",
				"DC22",
				"DC23",
				"DC24",
				"DC25",
				"DC26",
				"DC27",
				"DC28",
				"DC29",
				"DC43",
				"ETH",
				"KZN212",
				"KZN213",
				"KZN214",
				"KZN216",
				"KZN221",
				"KZN222",
				"KZN223",
				"KZN224",
				"KZN225",
				"KZN226",
				"KZN227",
				"KZN235",
				"KZN237",
				"KZN238",
				"KZN241",
				"KZN242",
				"KZN244",
				"KZN245",
				"KZN252",
				"KZN253",
				"KZN254",
				"KZN261",
				"KZN262",
				"KZN263",
				"KZN265",
				"KZN266",
				"KZN271",
				"KZN272",
				"KZN275",
				"KZN276",
				"KZN281",
				"KZN282",
				"KZN284",
				"KZN285",
				"KZN286",
				"KZN291",
				"KZN292",
				"KZN293",
				"KZN294",
				"KZN433",
				"KZN434",
				"KZN435",
				"KZN436"
			},
			new string[] {
				"DC33",
				"DC34",
				"DC35",
				"DC36",
				"DC47",
				"LIM331",
				"LIM332",
				"LIM333",
				"LIM334",
				"LIM335",
				"LIM341",
				"LIM343",
				"LIM344",
				"LIM345",
				"LIM351",
				"LIM353",
				"LIM354",
				"LIM355",
				"LIM361",
				"LIM362",
				"LIM366",
				"LIM367",
				"LIM368",
				"LIM471",
				"LIM472",
				"LIM473",
				"LIM476"
			},
			new string[] {
				"DC30",
				"DC31",
				"DC32",
				"MP301",
				"MP302",
				"MP303",
				"MP304",
				"MP305",
				"MP306",
				"MP307",
				"MP311",
				"MP312",
				"MP313",
				"MP314",
				"MP315",
				"MP316",
				"MP321",
				"MP324",
				"MP325",
				"MP326",
			},
			new string[] {
				"DC37",
				"DC38",
				"DC39",
				"DC40",
				"NW371",
				"NW372",
				"NW373",
				"NW374",
				"NW375",
				"NW381",
				"NW382",
				"NW383",
				"NW384",
				"NW385",
				"NW392",
				"NW393",
				"NW394",
				"NW396",
				"NW397",
				"NW403",
				"NW404",
				"NW405"
			},
			new string[] {
				"DC45", "DC6", "DC7", "DC8", "DC9",
				"NC061", "NC062", "NC064", "NC065", "NC066", "NC067",
				"NC071", "NC072", "NC073", "NC074", "NC075", "NC076", "NC077", "NC078",
				"NC082", "NC084", "NC085", "NC086", "NC087",
				"NC091", "NC092", "NC093", "NC094",
				"NC451", "NC452", "NC453",
			},
			new string[] 
			{
				"CPT",
				"DC1", "DC2", "DC3", "DC4", "DC5",
				"WC011", "WC012", "WC013", "WC014", "WC015",
				"WC022", "WC023", "WC024", "WC025", "WC026",
				"WC031", "WC032", "WC033", "WC034",
				"WC041", "WC042", "WC043", "WC044", "WC045", "WC047", "WC048",
				"WC051", "WC052", "WC053",
			},
		};
		static string[][] LGE2021ProvincesMunicipalities = new string[][]
		{
			new string[] {
				"BUF",
				"DC12", "DC13", "DC14", "DC15", "DC44",
				"EC101", "EC102", "EC104", "EC105", "EC106", "EC108", "EC109",
				"EC121", "EC122", "EC123", "EC124", "EC126", "EC129",
				"EC131", "EC135", "EC136", "EC137", "EC138", "EC139",
				"EC141", "EC142", "EC145",
				"EC153", "EC154", "EC155", "EC156", "EC157",
				"EC441", "EC442", "EC443", "EC444",
				"NMA",
			},
			new string[] {
				"DC16", "DC18", "DC19", "DC20",
				"FS161", "FS162", "FS163", "FS181", "FS182", "FS183", "FS184", "FS185",
				"FS191", "FS192", "FS193", "FS194", "FS195", "FS196",
				"FS201", "FS203", "FS204", "FS205",
				"MAN",
			},
			new string[] {
				"DC42", "DC48",
				"EKU",
				"GT421", "GT422", "GT423", "GT481", "GT484", "GT485",
				"JHB",
				"TSH",
			},
			new string[] {
				"DC21", "DC22", "DC23", "DC24", "DC25", "DC26", "DC27", "DC28", "DC29", "DC43",
				"ETH",
				"KZN212", "KZN213", "KZN214", "KZN216",
				"KZN221", "KZN222", "KZN223", "KZN224", "KZN225", "KZN226", "KZN227",
				"KZN235", "KZN237", "KZN238",
				"KZN241", "KZN242", "KZN244", "KZN245",
				"KZN252", "KZN253", "KZN254",
				"KZN261", "KZN262", "KZN263", "KZN265", "KZN266",
				"KZN271", "KZN272", "KZN275", "KZN276",
				"KZN281", "KZN282", "KZN284", "KZN285", "KZN286",
				"KZN291", "KZN292", "KZN293", "KZN294",
				"KZN433", "KZN434", "KZN435", "KZN436",
			},
			new string[] {
				"DC33", "DC34", "DC35", "DC36", "DC47",
				"LIM331", "LIM332", "LIM333", "LIM334", "LIM335",
				"LIM341", "LIM343", "LIM344", "LIM345",
				"LIM351", "LIM353", "LIM354", "LIM355",
				"LIM361", "LIM362", "LIM366", "LIM367", "LIM368",
				"LIM471", "LIM472", "LIM473", "LIM476",
			},
			new string[] {
				"DC30", "DC31", "DC32",
				"MP301", "MP302", "MP303", "MP304", "MP305", "MP306", "MP307",
				"MP311", "MP312", "MP313", "MP314", "MP315", "MP316",
				"MP321", "MP324", "MP325", "MP326"
			},
			new string[] {
				"DC37", "DC38", "DC39", "DC40",
				"NW371", "NW372", "NW373", "NW374", "NW375",
				"NW381", "NW382", "NW383", "NW384", "NW385",
				"NW392", "NW393", "NW394", "NW396", "NW397",
				"NW403", "NW404", "NW405",
			},
			new string[] {
				"DC45", "DC6", "DC7", "DC8", "DC9",
				"NC061", "NC062", "NC064", "NC065", "NC066", "NC067",
				"NC071", "NC072", "NC073", "NC074", "NC075", "NC076", "NC077", "NC078",
				"NC082", "NC084", "NC085", "NC086", "NC087",
				"NC091", "NC092", "NC093", "NC094",
				"NC451", "NC452", "NC453"
			},
			new string[] 
			{
				"CPT",
				"DC1", "DC2", "DC3", "DC4", "DC5",
				"WC011", "WC012", "WC013", "WC014", "WC015",
				"WC022", "WC023", "WC024", "WC025", "WC026",
				"WC031", "WC032", "WC033", "WC034",
				"WC041", "WC042", "WC043", "WC044", "WC045", "WC047", "WC048",
				"WC051", "WC052", "WC053"
			},
		};

		public static void DownloadSeatCounts(params int[] pks)
		{
			string directory = Path.Combine(Directory.GetCurrentDirectory(), "lge-seats");
			string logpath = Path.Combine(directory, "log.txt");

			if (File.Exists(logpath)) File.Delete(logpath);
			if (Directory.Exists(directory) is false) Directory.CreateDirectory(directory);
			
			using FileStream logfilestream = File.Open(logpath, FileMode.OpenOrCreate);
			using StreamWriter logstreamwriter = new(logfilestream);
			using HttpClient client = new();

			IEnumerable<(string prefix, string uribase, string[][] urisprovincemunicipality)> urivalues = pks.Select(pk => 
			{
				return pk switch
				{
					5 => ("LGE2000", LGE2000Base, LGE2000ProvincesMunicipalities),
					8 => ("LGE2006", LGE2006Base, LGE2006ProvincesMunicipalities),
					11 => ("LGE2011", LGE2011Base, LGE2011ProvincesMunicipalities),
					14 => ("LGE2016", LGE2016Base, LGE2016ProvincesMunicipalities),
					17 => ("LGE2021", LGE2021Base, LGE2021ProvincesMunicipalities),

					_ => (null as string, null as string, null as string[][])
				};

			}).OfType<(string, string, string[][])>();
			IEnumerable<(string name, Uri uri)> files = urivalues.SelectMany(urivalue => 
			{
				return urivalue.urisprovincemunicipality.SelectMany((province, index) => province.Select(municipality =>
				{
					int pk = index + 1; 
					string province = pk switch
					{
						3 => "GP",
						4 => "KN",
						5 => "NP",
						9 => "WP",

						_ => CSVRow.Utils.ProvincePkToId(pk)
					};

					string file = string.Format("{0}_{1}.xls", urivalue.prefix, municipality);
					string uri = string.Format("{0}/{1}/{2}.xls", urivalue.uribase, province, municipality);

					Console.WriteLine("{0}, '{1}'", file, uri);

					return (file.Replace('/', '_'), new Uri(uri));
				}));
			});
			Task[] tasks = files.Select(file => 
			{
				return Task.Run(async () =>
				{
					string filename = Path.Combine(directory, file.name);
					if (File.Exists(filename) is false)
						try
						{
							Console.WriteLine("Querying '{0}'", file.uri);

							using HttpRequestMessage request = new(HttpMethod.Get, file.uri);
							using HttpResponseMessage response = await client.SendAsync(request);
							if (response.IsSuccessStatusCode is false)
								throw new HttpRequestException(string.Format("Querying at '{0}' unsuccessfull. Code: {1}", file.uri, response.StatusCode));
							using FileStream fileStream = File.Open(filename, FileMode.OpenOrCreate);
							await response.Content.CopyToAsync(fileStream);
							lock (logstreamwriter)
								logstreamwriter.WriteLine("Querying '{0}' successfull", file.uri);
						}
						catch (Exception ex)
						{
							Console.WriteLine("Querying '{0}' failed", file.uri);
							lock (logstreamwriter)
								logstreamwriter.WriteLine(ex.Message);
						}

					return Task.CompletedTask;
				});
			}).ToArray();

			Task.WaitAll(tasks);
		}
	}
}